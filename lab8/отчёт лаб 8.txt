Лабораторная работа 8

Выполнила Наумкина Александра 505277 Р3122

1. Импорты и начальная инициализация (строки 1-23)
Ключевые компоненты:

Author, App, User, Currency, UserCurrency - модели данных

get_currencies - функция из внешнего модуля для получения курсов

Создание главных объектов: main_author и main_app

2. Функция setup_initial_data() (строки 26-44)
Назначение: Инициализация тестовых данных при запуске сервера.

Логика работы:

Получает актуальные курсы валют через API

Создает тестовые подписки.

3. Настройка Jinja2 (строки 46-57)

4. Функция get_navigation() (строки 60-73)
Назначение: Создает навигационное меню с выделением активной страницы.

5. Основной класс SimpleHTTPController (строки 76-259)
Класс наследуется от BaseHTTPRequestHandler и обрабатывает все HTTP-запросы.

6. Метод do_GET() (строки 83-104)
Маршрутизатор запросов:

Парсит URL и query-параметры

Определяет путь и вызывает соответствующий обработчик

Поддерживаемые пути:

/ - главная страница

/users - список пользователей

/user?id=X - детали пользователя

/currencies - список валют

/author - информация об авторе

/static/... - статические файлы

Вспомогательный метод _render_and_send() (строки 106-120)
Назначение: Универсальный рендерер шаблонов.

Особенности:

Добавляет объект main_app в контекст всех шаблонов

Обрабатывает исключения рендеринга (отправляет 500 ошибку)

Устанавливает правильные HTTP-заголовки (Content-type, charset)

Обработчики страниц:
A. handle_index() (строки 122-132)

Главная страница приложения

Передает основную информацию о приложении и авторе

B. handle_users() (строки 134-142)

Список всех пользователей из словаря USERS

Простой отображение без фильтрации

C. handle_user_detail() (строки 144-169)

Детальная информация о пользователе

Получает ID из query-параметра ?id=X

Отображает подписки пользователя на валюты

Валидация: проверка наличия ID, корректности формата, существования пользователя

D. handle_currencies() (строки 171-184)

Важная особенность: При каждом запросе обновляет курсы валют через API

Сортирует валюты по буквенному коду

Использует глобальную переменную CURRENCIES

E. handle_author() (строки 186-194)

Страница с информацией об авторе приложения

Передает объекты author и app

Обработка статических файлов (строки 196-225)
Особенности:

Обслуживает файлы из папки static/

Определяет MIME-типы по расширению файла:

.css → text/css

.js → application/javascript

.png → image/png

Обрабатывает ошибки: 404 если файл не найден

Обработчики ошибок:
handle_404() (строки 227-244)

Возвращает HTML-страницу с ошибкой 404

Содержит полезную информацию и ссылку на главную

handle_500() (строки 246-259)

Обработчик внутренних ошибок сервера

Отображает детали ошибки (в продакшн-среде это небезопасно!)

7. Функция run() (строки 262-277)
Назначение: Запуск и настройка HTTP-сервера.

Параметры:

server_class=HTTPServer - класс сервера

handler_class=SimpleHTTPController - обработчик запросов

port=8000 - порт по умолчанию

Последовательность действий:

Инициализирует данные через setup_initial_data()

Создает экземпляр сервера

Запускает бесконечный цикл обработки запросов

Обрабатывает прерывание (Ctrl+C) для graceful shutdown